_Fundamental_Types = Dict(
    "income_statement"=> [
        "Amortization",
        "AmortizationOfIntangiblesIncomeStatement",
        "AverageDilutionEarnings",
        "BasicAccountingChange",
        "BasicAverageShares",
        "BasicContinuousOperations",
        "BasicDiscontinuousOperations",
        "BasicEPS",
        "BasicEPSOtherGainsLosses",
        "BasicExtraordinary",
        "ContinuingAndDiscontinuedBasicEPS",
        "ContinuingAndDiscontinuedDilutedEPS",
        "CostOfRevenue",
        "DepletionIncomeStatement",
        "DepreciationAmortizationDepletionIncomeStatement",
        "DepreciationAndAmortizationInIncomeStatement",
        "DepreciationIncomeStatement",
        "DilutedAccountingChange",
        "DilutedAverageShares",
        "DilutedContinuousOperations",
        "DilutedDiscontinuousOperations",
        "DilutedEPS",
        "DilutedEPSOtherGainsLosses",
        "DilutedExtraordinary",
        "DilutedNIAvailtoComStockholders",
        "DividendPerShare",
        "EBIT",
        "EBITDA",
        "EarningsFromEquityInterest",
        "EarningsFromEquityInterestNetOfTax",
        "ExciseTaxes",
        "GainOnSaleOfBusiness",
        "GainOnSaleOfPPE",
        "GainOnSaleOfSecurity",
        "GeneralAndAdministrativeExpense",
        "GrossProfit",
        "ImpairmentOfCapitalAssets",
        "InsuranceAndClaims",
        "InterestExpense",
        "InterestExpenseNonOperating",
        "InterestIncome",
        "InterestIncomeNonOperating",
        "MinorityInterests",
        "NetIncome",
        "NetIncomeCommonStockholders",
        "NetIncomeContinuousOperations",
        "NetIncomeDiscontinuousOperations",
        "NetIncomeExtraordinary",
        "NetIncomeFromContinuingAndDiscontinuedOperation",
        "NetIncomeFromContinuingOperationNetMinorityInterest",
        "NetIncomeFromTaxLossCarryforward",
        "NetIncomeIncludingNoncontrollingInterests",
        "NetInterestIncome",
        "NetNonOperatingInterestIncomeExpense",
        "NormalizedBasicEPS",
        "NormalizedDilutedEPS",
        "NormalizedEBITDA",
        "NormalizedIncome",
        "OperatingExpense",
        "OperatingIncome",
        "OperatingRevenue",
        "OtherGandA",
        "OtherIncomeExpense",
        "OtherNonOperatingIncomeExpenses",
        "OtherOperatingExpenses",
        "OtherSpecialCharges",
        "OtherTaxes",
        "OtherunderPreferredStockDividend",
        "PreferredStockDividends",
        "PretaxIncome",
        "ProvisionForDoubtfulAccounts",
        "ReconciledCostOfRevenue",
        "ReconciledDepreciation",
        "RentAndLandingFees",
        "RentExpenseSupplemental",
        "ReportedNormalizedBasicEPS",
        "ReportedNormalizedDilutedEPS",
        "ResearchAndDevelopment",
        "RestructuringAndMergernAcquisition",
        "SalariesAndWages",
        "SecuritiesAmortization",
        "SellingAndMarketingExpense",
        "SellingGeneralAndAdministration",
        "SpecialIncomeCharges",
        "TaxEffectOfUnusualItems",
        "TaxLossCarryforwardBasicEPS",
        "TaxLossCarryforwardDilutedEPS",
        "TaxProvision",
        "TaxRateForCalcs",
        "TotalExpenses",
        "TotalOperatingIncomeAsReported",
        "TotalOtherFinanceCost",
        "TotalRevenue",
        "TotalUnusualItems",
        "TotalUnusualItemsExcludingGoodwill",
        "WriteOff",
    ],
    "balance_sheet"=> [
        "AccountsPayable",
        "AccountsReceivable",
        "AccruedInterestReceivable",
        "AccumulatedDepreciation",
        "AdditionalPaidInCapital",
        "AllowanceForDoubtfulAccountsReceivable",
        "AssetsHeldForSaleCurrent",
        "AvailableForSaleSecurities",
        "BuildingsAndImprovements",
        "CapitalLeaseObligations",
        "CapitalStock",
        "CashAndCashEquivalents",
        "CashCashEquivalentsAndShortTermInvestments",
        "CashEquivalents",
        "CashFinancial",
        "CommercialPaper",
        "CommonStock",
        "CommonStockEquity",
        "ConstructionInProgress",
        "CurrentAccruedExpenses",
        "CurrentAssets",
        "CurrentCapitalLeaseObligation",
        "CurrentDebt",
        "CurrentDebtAndCapitalLeaseObligation",
        "CurrentDeferredAssets",
        "CurrentDeferredLiabilities",
        "CurrentDeferredRevenue",
        "CurrentDeferredTaxesAssets",
        "CurrentDeferredTaxesLiabilities",
        "CurrentLiabilities",
        "CurrentNotesPayable",
        "CurrentProvisions",
        "DefinedPensionBenefit",
        "DerivativeProductLiabilities",
        "DividendsPayable",
        "DuefromRelatedPartiesCurrent",
        "DuefromRelatedPartiesNonCurrent",
        "DuetoRelatedPartiesCurrent",
        "DuetoRelatedPartiesNonCurrent",
        "EmployeeBenefits",
        "FinancialAssets",
        "FinancialAssetsDesignatedasFairValueThroughProfitorLossTotal",
        "FinishedGoods",
        "FixedAssetsRevaluationReserve",
        "ForeignCurrencyTranslationAdjustments",
        "GainsLossesNotAffectingRetainedEarnings",
        "GeneralPartnershipCapital",
        "Goodwill",
        "GoodwillAndOtherIntangibleAssets",
        "GrossAccountsReceivable",
        "GrossPPE",
        "HedgingAssetsCurrent",
        "HeldToMaturitySecurities",
        "IncomeTaxPayable",
        "InterestPayable",
        "InventoriesAdjustmentsAllowances",
        "Inventory",
        "InvestedCapital",
        "InvestmentProperties",
        "InvestmentinFinancialAssets",
        "InvestmentsAndAdvances",
        "InvestmentsInOtherVenturesUnderEquityMethod",
        "InvestmentsinAssociatesatCost",
        "InvestmentsinJointVenturesatCost",
        "InvestmentsinSubsidiariesatCost",
        "LandAndImprovements",
        "Leases",
        "LiabilitiesHeldforSaleNonCurrent",
        "LimitedPartnershipCapital",
        "LineOfCredit",
        "LoansReceivable",
        "LongTermCapitalLeaseObligation",
        "LongTermDebt",
        "LongTermDebtAndCapitalLeaseObligation",
        "LongTermEquityInvestment",
        "LongTermProvisions",
        "MachineryFurnitureEquipment",
        "MinimumPensionLiabilities",
        "MinorityInterest",
        "NetDebt",
        "NetPPE",
        "NetTangibleAssets",
        "NonCurrentAccountsReceivable",
        "NonCurrentAccruedExpenses",
        "NonCurrentDeferredAssets",
        "NonCurrentDeferredLiabilities",
        "NonCurrentDeferredRevenue",
        "NonCurrentDeferredTaxesAssets",
        "NonCurrentDeferredTaxesLiabilities",
        "NonCurrentNoteReceivables",
        "NonCurrentPensionAndOtherPostretirementBenefitPlans",
        "NonCurrentPrepaidAssets",
        "NotesReceivable",
        "OrdinarySharesNumber",
        "OtherCapitalStock",
        "OtherCurrentAssets",
        "OtherCurrentBorrowings",
        "OtherCurrentLiabilities",
        "OtherEquityAdjustments",
        "OtherEquityInterest",
        "OtherIntangibleAssets",
        "OtherInventories",
        "OtherInvestments",
        "OtherNonCurrentAssets",
        "OtherNonCurrentLiabilities",
        "OtherPayable",
        "OtherProperties",
        "OtherReceivables",
        "OtherShortTermInvestments",
        "Payables",
        "PayablesAndAccruedExpenses",
        "PensionandOtherPostRetirementBenefitPlansCurrent",
        "PreferredSecuritiesOutsideStockEquity",
        "PreferredSharesNumber",
        "PreferredStock",
        "PreferredStockEquity",
        "PrepaidAssets",
        "Properties",
        "RawMaterials",
        "Receivables",
        "ReceivablesAdjustmentsAllowances",
        "RestrictedCash",
        "RestrictedCommonStock",
        "RetainedEarnings",
        "ShareIssued",
        "StockholdersEquity",
        "TangibleBookValue",
        "TaxesReceivable",
        "TotalAssets",
        "TotalCapitalization",
        "TotalDebt",
        "TotalEquityGrossMinorityInterest",
        "TotalLiabilitiesNetMinorityInterest",
        "TotalNonCurrentAssets",
        "TotalNonCurrentLiabilitiesNetMinorityInterest",
        "TotalPartnershipCapital",
        "TotalTaxPayable",
        "TradeandOtherPayablesNonCurrent",
        "TradingSecurities",
        "TreasurySharesNumber",
        "TreasuryStock",
        "UnrealizedGainLoss",
        "WorkInProcess",
        "WorkingCapital",
    ],
    "cash_flow"=> [
        "AdjustedGeographySegmentData",
        "AmortizationCashFlow",
        "AmortizationOfIntangibles",
        "AmortizationOfSecurities",
        "AssetImpairmentCharge",
        "BeginningCashPosition",
        "CapitalExpenditure",
        "CapitalExpenditureReported",
        "CashDividendsPaid",
        "CashFlowFromContinuingFinancingActivities",
        "CashFlowFromContinuingInvestingActivities",
        "CashFlowFromContinuingOperatingActivities",
        "CashFlowFromDiscontinuedOperation",
        "CashFlowsfromusedinOperatingActivitiesDirect",
        "CashFromDiscontinuedFinancingActivities",
        "CashFromDiscontinuedInvestingActivities",
        "CashFromDiscontinuedOperatingActivities",
        "ChangeInAccountPayable",
        "ChangeInAccruedExpense",
        "ChangeInCashSupplementalAsReported",
        "ChangeInDividendPayable",
        "ChangeInIncomeTaxPayable",
        "ChangeInInterestPayable",
        "ChangeInInventory",
        "ChangeInOtherCurrentAssets",
        "ChangeInOtherCurrentLiabilities",
        "ChangeInOtherWorkingCapital",
        "ChangeInPayable",
        "ChangeInPayablesAndAccruedExpense",
        "ChangeInPrepaidAssets",
        "ChangeInReceivables",
        "ChangeInTaxPayable",
        "ChangeInWorkingCapital",
        "ChangesInAccountReceivables",
        "ChangesInCash",
        "ClassesofCashPayments",
        "ClassesofCashReceiptsfromOperatingActivities",
        "CommonStockDividendPaid",
        "CommonStockIssuance",
        "CommonStockPayments",
        "DeferredIncomeTax",
        "DeferredTax",
        "Depletion",
        "Depreciation",
        "DepreciationAmortizationDepletion",
        "DepreciationAndAmortization",
        "DividendPaidCFO",
        "DividendReceivedCFO",
        "DividendsPaidDirect",
        "DividendsReceivedCFI",
        "DividendsReceivedDirect",
        "DomesticSales",
        "EarningsLossesFromEquityInvestments",
        "EffectOfExchangeRateChanges",
        "EndCashPosition",
        "ExcessTaxBenefitFromStockBasedCompensation",
        "FinancingCashFlow",
        "ForeignSales",
        "FreeCashFlow",
        "GainLossOnInvestmentSecurities",
        "GainLossOnSaleOfBusiness",
        "GainLossOnSaleOfPPE",
        "IncomeTaxPaidSupplementalData",
        "InterestPaidCFF",
        "InterestPaidCFO",
        "InterestPaidDirect",
        "InterestPaidSupplementalData",
        "InterestReceivedCFI",
        "InterestReceivedCFO",
        "InterestReceivedDirect",
        "InvestingCashFlow",
        "IssuanceOfCapitalStock",
        "IssuanceOfDebt",
        "LongTermDebtIssuance",
        "LongTermDebtPayments",
        "NetBusinessPurchaseAndSale",
        "NetCommonStockIssuance",
        "NetForeignCurrencyExchangeGainLoss",
        "NetIncome",
        "NetIncomeFromContinuingOperations",
        "NetIntangiblesPurchaseAndSale",
        "NetInvestmentPropertiesPurchaseAndSale",
        "NetInvestmentPurchaseAndSale",
        "NetIssuancePaymentsOfDebt",
        "NetLongTermDebtIssuance",
        "NetOtherFinancingCharges",
        "NetOtherInvestingChanges",
        "NetPPEPurchaseAndSale",
        "NetPreferredStockIssuance",
        "NetShortTermDebtIssuance",
        "OperatingCashFlow",
        "OperatingGainsLosses",
        "OtherCashAdjustmentInsideChangeinCash",
        "OtherCashAdjustmentOutsideChangeinCash",
        "OtherCashPaymentsfromOperatingActivities",
        "OtherCashReceiptsfromOperatingActivities",
        "OtherNonCashItems",
        "PaymentsonBehalfofEmployees",
        "PaymentstoSuppliersforGoodsandServices",
        "PensionAndEmployeeBenefitExpense",
        "PreferredStockDividendPaid",
        "PreferredStockIssuance",
        "PreferredStockPayments",
        "ProceedsFromStockOptionExercised",
        "ProvisionandWriteOffofAssets",
        "PurchaseOfBusiness",
        "PurchaseOfIntangibles",
        "PurchaseOfInvestment",
        "PurchaseOfInvestmentProperties",
        "PurchaseOfPPE",
        "ReceiptsfromCustomers",
        "ReceiptsfromGovernmentGrants",
        "RepaymentOfDebt",
        "RepurchaseOfCapitalStock",
        "SaleOfBusiness",
        "SaleOfIntangibles",
        "SaleOfInvestment",
        "SaleOfInvestmentProperties",
        "SaleOfPPE",
        "ShortTermDebtIssuance",
        "ShortTermDebtPayments",
        "StockBasedCompensation",
        "TaxesRefundPaid",
        "TaxesRefundPaidDirect",
        "UnrealizedGainLossOnInvestmentSecurities",
    ],
    "valuation"=> [
        "ForwardPeRatio",
        "PsRatio",
        "PbRatio",
        "EnterprisesValueEBITDARatio",
        "EnterprisesValueRevenueRatio",
        "PeRatio",
        "MarketCap",
        "EnterpriseValue",
        "PegRatio"
    ]
)

_Fundamental_Intervals = [
    "annual",
    "quarterly",
    "monthly",
]


"""
    get_Fundamental(symbol::AbstractString, item::AbstractString,interval::AbstractString, startdt, enddt)

Retrievs financial statement information from Yahoo Finance stored in a Dictionary.

# Arguments

 * smybol`::String` is a ticker (e.g. AAPL for Apple Computers, or ^GSPC for the S&P500)  

 * item`::String` can either be an entire financial statement or a subitem. Entire financial statements:"income_statement", "valuation", "cash_flow", "balance_sheet".  To see valid sub items grouped by financial statement type in a Dictionary call `_Fundamental_Types`  

 * interval`::String` can be one of "annual", "quarterly", "monthly"  

 * `startdt` and `enddt` take the following types: `::Date`,`::DateTime`, or a `String` of the following form `yyyy-mm-dd`  

 *  throw_error`::Bool` defaults to `false`. If set to true the function errors when the ticker is not valid. Else a warning is given and an empty dictionary is returned.

# Examples
```julia-repl
julia> get_Fundamental("NFLX", "income_statement","quarterly","2000-01-01","2022-12-31")

Dict{String, Any} with 39 entries:
"NetNonOperatingInterestIncomeExpense" => Any[-94294000, -80917000, 8066000, 44771000, 88829000]
"NetInterestIncome"                    => Any[-94294000, -80917000, 8066000, 44771000, 88829000]
"InterestExpense"                      => Any[190429000, 189429000, 187579000, 175455000, 172575000]
⋮                                      => ⋮

julia> using DataFrames
julia> get_Fundamental("AAPL", "InterestExpense","quarterly","2000-01-01","2022-12-31") |> DataFrame
5×2 DataFrame
Row │ InterestExpense  timestamp
    │ Any              DateTime
────┼──────────────────────────────────────
  1 │ 672000000        2021-09-30T00:00:00 
  2 │ 694000000        2021-12-31T00:00:00
  3 │ 691000000        2022-03-31T00:00:00
  4 │ 719000000        2022-06-30T00:00:00
  5 │ 827000000        2022-09-30T00:00:00
```
"""
function get_Fundamental(symbol::AbstractString, item::AbstractString,interval::AbstractString, startdt, enddt;throw_error=false)

     # Check if symbol is valid
     old_symbol = symbol
     symbol = get_valid_symbols(symbol)
     if isempty(symbol)
         if throw_error
             error("$old_symbol is not a valid Symbol!")
         else
             @warn "$old_symbol is not a valid Symbol an empy Dictionary was returned!" 
             return Dict()
         end
     else
         symbol = symbol[1]
     end

    # Check Start and end dates. 
    if !isequal(startdt,"") || !isequal(enddt,"")
        range = ""
        if typeof(startdt) <: Date
            startdt = Int(round(Dates.datetime2unix(Dates.DateTime(startdt))))
            enddt = Int(round(Dates.datetime2unix(Dates.DateTime(enddt))))
        elseif typeof(startdt) <:DateTime
            startdt = Int(round(Dates.datetime2unix(startdt)))
            enddt = Int(round(Dates.datetime2unix(enddt)))
        elseif typeof(startdt) <: AbstractString
            startdt = Int(round(Dates.datetime2unix(Dates.DateTime(Dates.Date(startdt,Dates.DateFormat("yyyy-mm-dd"))))))
            enddt = Int(round(Dates.datetime2unix(Dates.DateTime(Dates.Date(enddt,Dates.DateFormat("yyyy-mm-dd"))))))
        else
            error("Startdt and Enddt must be either a Date, a DateTime, or a string of the following format yyyy-mm-dd!")
        end
    end
    @assert in(interval, _Fundamental_Intervals) "Chosen interval is not supported. Choose one of: annual, quarterly, monthly"
    #Build Query:
    if in(item, keys(_Fundamental_Types))
        entire_statement = true
        query_items = join(string.(interval,_Fundamental_Types[item]),",")
    else
        entire_statement = false
        @assert in(item, vcat([_Fundamental_Types[i] for i in keys(_Fundamental_Types)]...)) "Chosen item is not supported. View supported items by calling _Fundamental_Types"
        query_items = string(interval, item)
    end
    q = Dict(
        "symbol"=>symbol,
        "type" => query_items,
        "period1"=>startdt,
        "period2"=>enddt,
        "formatted" => "false"
    )  
    url = "https://query2.finance.yahoo.com/ws/fundamentals-timeseries/v1/finance/timeseries/$(symbol)"
    res = HTTP.get(url,query = q)
    res = JSON3.read(res.body).timeseries.result
    if entire_statement
        result = Dict{String,Any}()
        for i in eachindex(res)
            #continue if there is no data for this element
            if !in(:timestamp,keys(res[i]))
                continue
            end
            unix2datetime.(res[i].timestamp)
            k = res[i].meta.type[1]
            element_result = []
            for j in values(res[i][Symbol(k)])
                push!(element_result,j.reportedValue.raw)
            end
            result[replace(k,r"^(quarterly|annual|monthly)"=>"")] = element_result
        end
    else
        if !in(Symbol(query_items),keys(res[1]))
            error("There is no data available for this item.")
        else
            value = []
            for i in values(res[1][Symbol(query_items)])
                push!(value, i.reportedValue.raw)
            end

            result = Dict("timestamp" => unix2datetime.(res[1].timestamp),item =>value)
        end             
    end
    return result
end
